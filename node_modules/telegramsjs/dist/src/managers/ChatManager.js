"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ChatManager = void 0;
const BaseManager_1 = require("./BaseManager");
const Chat_1 = require("../structures/chat/Chat");
const ChatFullInfo_1 = require("../structures/chat/ChatFullInfo");
const Message_1 = require("../structures/message/Message");
const ChatMember_1 = require("../structures/chat/ChatMember");
const TelegramError_1 = require("../errors/TelegramError");
const ErrorCodes_1 = require("../errors/ErrorCodes");
class ChatManager extends BaseManager_1.BaseManager {
    constructor(client, iterable, options = {}) {
        super(client, Chat_1.Chat, iterable, options);
    }
    resolve(chat) {
        if (chat instanceof ChatMember_1.ChatMember) {
            return super.resolve(chat.chatId);
        }
        if (chat instanceof Message_1.Message && chat.chat) {
            return chat.chat;
        }
        return super.resolve(chat);
    }
    async fetch(chat, { cache = true, force = false, fullInfo } = {}) {
        const id = this.resolveId(chat);
        if (!force) {
            const existing = this.cache.get(String(id));
            if (existing)
                return existing;
        }
        const data = await this.client.rest.request("getChat", {
            chat_id: id,
        });
        if ((data === null || data === void 0 ? void 0 : data.type) === "private") {
            throw new TelegramError_1.TelegramError(ErrorCodes_1.ErrorCodes.InvalidChatId);
        }
        if (fullInfo) {
            this._add(data, cache);
            return new ChatFullInfo_1.ChatFullInfo(this.client, data);
        }
        return this._add(data, cache);
    }
}
exports.ChatManager = ChatManager;
