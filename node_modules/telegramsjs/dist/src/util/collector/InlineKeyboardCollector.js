"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.InlineKeyboardCollector = void 0;
const Constants_1 = require("../Constants");
const Collector_1 = require("./Collector");
class InlineKeyboardCollector extends Collector_1.Collector {
    constructor(client, options = {}) {
        super(options);
        Object.defineProperty(this, "client", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: client
        });
        Object.defineProperty(this, "options", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: options
        });
        Object.defineProperty(this, "received", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: 0
        });
        client.incrementMaxListeners();
        client.on(Constants_1.Events.CallbackQuery, this.handleCollect);
        this.once(Constants_1.CollectorEvents.End, () => {
            client.off(Constants_1.Events.CallbackQuery, this.handleCollect);
            client.decrementMaxListeners();
        });
    }
    collect(callbackQuery) {
        this.received++;
        return callbackQuery.id || null;
    }
    dispose(callbackQuery) {
        return callbackQuery.id || null;
    }
    get endReason() {
        const { max, maxProcessed } = this.options;
        if (max && this.collected.size >= max) {
            return "limit";
        }
        if (maxProcessed && this.received === maxProcessed) {
            return "processedLimit";
        }
        return super.endReason;
    }
}
exports.InlineKeyboardCollector = InlineKeyboardCollector;
