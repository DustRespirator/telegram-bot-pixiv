"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ChatPermissions = void 0;
class ChatPermissions {
    constructor(data = {}) {
        Object.defineProperty(this, "allowed", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        Object.defineProperty(this, "denied", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        this.allowed = new Set();
        this.denied = new Set();
        this._patch(data);
    }
    allow(permissions) {
        if (!permissions)
            return this;
        if (permissions instanceof ChatPermissions) {
            permissions = permissions.toObject();
        }
        else if (typeof permissions === "string") {
            permissions = { [permissions]: true };
        }
        for (const [key, value] of Object.entries(permissions)) {
            const perm = key;
            if (value) {
                this.allowed.add(perm);
                this.denied.delete(perm);
            }
        }
        return this;
    }
    deny(permissions) {
        if (!permissions)
            return this;
        if (permissions instanceof ChatPermissions) {
            permissions = permissions.toObject();
        }
        else if (typeof permissions === "string") {
            permissions = { [permissions]: true };
        }
        for (const [key, value] of Object.entries(permissions)) {
            const perm = key;
            if (value) {
                this.denied.add(perm);
                this.allowed.delete(perm);
            }
        }
        return this;
    }
    has(permission) {
        return this.allowed.has(permission);
    }
    toObject() {
        const flags = {};
        for (const perm of this.allowed) {
            flags[perm] = true;
        }
        for (const perm of this.denied) {
            if (!flags[perm]) {
                flags[perm] = false;
            }
        }
        return flags;
    }
    equals(other) {
        if (!other || !(other instanceof ChatPermissions))
            return false;
        const thisAllowed = Array.from(this.allowed).sort();
        const otherAllowed = Array.from(other.allowed).sort();
        const thisDenied = Array.from(this.denied).sort();
        const otherDenied = Array.from(other.denied).sort();
        return (thisAllowed.length === otherAllowed.length &&
            thisDenied.length === otherDenied.length &&
            thisAllowed.every((perm, index) => perm === otherAllowed[index]) &&
            thisDenied.every((perm, index) => perm === otherDenied[index]));
    }
    _patch(data) {
        for (const [key, value] of Object.entries(data)) {
            if (value) {
                this.allowed.add(key);
            }
            else {
                this.denied.add(key);
            }
        }
    }
    static isValid(permission) {
        return Object.keys(ChatPermissions.Flags).includes(permission);
    }
}
exports.ChatPermissions = ChatPermissions;
Object.defineProperty(ChatPermissions, "Flags", {
    enumerable: true,
    configurable: true,
    writable: true,
    value: {
        sendMessages: 1,
        sendAudios: 2,
        sendDocuments: 3,
        sendPhotos: 4,
        sendVideos: 5,
        sendVideoNotes: 6,
        sendVoiceNotes: 7,
        sendPolls: 8,
        sendOtherMessages: 9,
        addWebPagePreviews: 10,
        changeInfo: 11,
        inviteUsers: 12,
        pinMessages: 13,
        manageTopics: 14,
        isAnonymous: 15,
    }
});
